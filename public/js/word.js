// Generated by CoffeeScript 1.12.7
(function() {
  var ajax_callback, ajax_on_new_callback, alertErrShow, alertShow, fillInExtension, fillWord, onLoadExtension, on_audio_btn_click;

  $(document).ready(function() {
    on_audio_btn_click();
    onLoadExtension();
    $('#get_word_btn').click(function(e) {
      var val;
      e.preventDefault();
      val = $('#name').val();
      return $.get('/words/search?word=' + val, ajax_callback, 'json');
    });
    return $('#btn_my_word_submit').click(function(e) {
      e.preventDefault();
      return $.post('/words/new', ajax_on_new_callback, 'json');
    });
  });

  ajax_on_new_callback = function(data) {
    var my_words, status;
    status = data.status;
    my_words = data.word;
    if (status === 'OK') {
      return fillInExtension(my_words);
    } else {
      return alertErrShow('出错了！！');
    }
  };

  ajax_callback = function(data) {
    var btn_my_word_submit, btn_name;
    fillWord(data.lexicon);
    if (data.my_word != null) {
      fillInExtension(data.my_word);
    } else {
      btn_name = "将" + data['name'] + "添加进单词本";
      btn_my_word_submit = $('#btn_my_word_submit');
      $('#my_word_extension').removeProp('disabled').val('');
      btn_my_word_submit.removeProp('disabled').val(btn_name);
      if (data.lexicon) {
        btn_my_word_submit.show();
        $('#alert_div').hide();
      } else {
        btn_my_word_submit.hide();
        alertErrShow('找不到该单词！');
      }
    }
    on_audio_btn_click();
  };

  fillWord = function(lexicon) {
    if (lexicon == null) {
      return false;
    }
    $('#UK').html(lexicon['UK']);
    $('#US').html(lexicon['US']);
    $('#audio_uk').attr('src', lexicon['UKMP3']);
    $('#audio_us').attr('src', lexicon['USMP3']);
    $('#interpetation').html(lexicon['interpetation']);
    $('#my_word_word').val(lexicon['name']);
    return true;
  };

  onLoadExtension = function() {
    var val;
    val = $('#my_word_extension').val();
    if (val) {
      return fillInExtension();
    }
  };

  fillInExtension = function(data) {
    var text;
    text = data ? '该单词已经添加在你个人单词本^_^' : '已添加进单词本！';
    if (data) {
      $('#my_word_extension').val(data.word);
    }
    $('#my_word_extension').attr('disabled', 'disabled');
    alertShow(text);
    return $('#btn_my_word_submit').hide();
  };

  on_audio_btn_click = function() {
    return $("button[data-id]").click(function(e) {
      var mp3;
      e.preventDefault();
      mp3 = document.getElementById($(this).attr('data-id'));
      mp3.play();
    });
  };

  alertErrShow = function(text) {
    alertShow(text, 'alert-danger');
  };

  alertShow = function(text, css) {
    var alert_div;
    if (css == null) {
      css = 'alert-success';
    }
    alert_div = $('#alert_div');
    alert_div.addClass('alert ' + css).html(text).show();
  };

}).call(this);
